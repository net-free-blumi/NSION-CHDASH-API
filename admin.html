<!DOCTYPE html>
<html dir="rtl" lang="he-il">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>× ×™×”×•×œ ××•×¦×¨×™× - ×’×•×œ×“</title>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <!-- ×¢×™×’×•×œ ×˜×¢×™× ×” ×œ×©×¨×ª -->
    <div id="serverWakeupOverlay" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.85);z-index:9999;align-items:center;justify-content:center;flex-direction:column;">
        <div style="width:70px;height:70px;border:8px solid #eee;border-top:8px solid #007bff;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:20px;"></div>
        <div style="font-size:1.3em;color:#007bff;font-weight:bold;">×”×©×¨×ª ×‘×”×¤×¢×œ×”...<br>×× × ×”××ª×Ÿ</div>
    </div>
    <style>
        @keyframes spin { 0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);} }
        #serverWakeupOverlay { display: flex; }
    </style>
    <div class="admin-container">
        <div class="header">
            <h1>ğŸ›ï¸ ××¢×¨×›×ª × ×™×”×•×œ ××•×¦×¨×™× - ×’×•×œ×“</h1>
            <p>× ×™×”×•×œ ××ª×§×“× ×©×œ ×›×œ ×”××•×¦×¨×™× ×•×”××’×©×™× </p>
        </div>
        <div class="admin-panel">
            <div class="sidebar">
                <div class="stats" id="stats-container">
                    <div class="stat-item">
                        <span class="stat-number">0</span>
                        <span class="stat-label">×¡×”"×› ××•×¦×¨×™×</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">0</span>
                        <span class="stat-label">××•×¦×¨×™ ×’×“×œ×™×</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">0</span>
                        <span class="stat-label">××•×¦×¨×™ ×›××•×ª</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">0</span>
                        <span class="stat-label">×œ×œ× ×›××•×ª</span>
                    </div>
                </div>
                <div class="quick-action-buttons">
                    <button onclick="productManager.openAddProductModal()" class="btn">â• ×”×•×¡×¤×ª ××•×¦×¨ ×—×“×©</button>
                    <button onclick="productManager.refreshProducts()" class="btn btn-success">ğŸ”„ ×¨×¢× ×•×Ÿ ××•×¦×¨×™×</button>
                    <button onclick="productManager.saveProductsToFile()" class="btn btn-info">ğŸ’¾ ×©××•×¨ ×œ×§×•×‘×¥</button>
                    <button onclick="productManager.exportProducts()" class="btn btn-warning">ğŸ“¤ ×™×™×¦×•× ××•×¦×¨×™×</button>
                    <button onclick="productManager.importProducts()" class="btn btn-warning">ğŸ“¥ ×™×™×‘×•× ××•×¦×¨×™×</button>
                    <button onclick="productManager.backupProducts()" class="btn btn-info">ğŸ’¾ ×™×¦×™×¨×ª ×’×™×‘×•×™</button>
                </div>
                <div class="search-section">
                    <h3>ğŸ” ×—×™×¤×•×© ××•×¦×¨×™×</h3>
                    <input type="text" id="search-input" placeholder="×—×¤×© ×œ×¤×™ ×©×, ×§×•×“ ××• ×§×˜×’×•×¨×™×”..." class="search-input">
                </div>
            </div>
            <div class="main-content">
                <div class="content-header">
                    <h2>ğŸ“‹ ×¨×©×™××ª ×”××•×¦×¨×™×</h2>
                    <div class="header-actions">
                        <input type="file" id="file-input" accept=".json" style="display: none;" onchange="productManager.loadProductsFromFile(this.files[0])">
                        <button onclick="document.getElementById('file-input').click()" class="btn btn-info">ğŸ“ ×˜×¢×Ÿ ××§×•×‘×¥</button>
                    </div>
                </div>
                <div id="products-container" class="products-grid">
                    <!-- ×”××•×¦×¨×™× ×™×•×¦×’×• ×›××Ÿ -->
                </div>
            </div>
        </div>
    </div>
    <style>
    /* ×¢×™×¦×•×‘ ×¨×¡×¤×•× ×¡×™×‘×™ ×œ××–×•×¨ ×”×¢×œ×™×•×Ÿ ×‘××•×‘×™×™×œ */
    .search-input {
        width: 90%;
        max-width: 260px;
        min-width: 120px;
        padding: 7px 14px;
        border-radius: 22px;
        border: 1px solid #ccc;
        font-size: 1em;
        margin: 0 auto 10px auto;
        display: block;
        box-sizing: border-box;
        transition: border 0.2s;
    }
    .search-input:focus {
        border: 1.5px solid #007bff;
        outline: none;
    }
    @media (max-width: 900px) {
        .main-content { margin-top: 10px; }
        .admin-container, .admin-panel, .main-content, .sidebar {
            width: 100% !important;
            min-width: 0;
            max-width: 100vw;
            box-sizing: border-box;
        }
        .products-grid {
            grid-template-columns: 1fr !important;
        }
        .product-card {
            min-width: 0;
            max-width: 98vw;
        }
        .sidebar {
            padding: 0 2vw;
        }
        .search-input {
            width: 98vw;
            max-width: 99vw;
            font-size: 1em;
        }
    }
    </style>

    <!-- ××™×›×œ ×œ×”×•×“×¢×•×ª ××¢×¨×›×ª -->
    <div id="notifications-container"></div>

    <!-- Modal ×œ×”×•×¡×¤×ª/×¢×¨×™×›×ª ××•×¦×¨ -->
    <div id="productModal" class="modal" onclick="if(event.target.id === 'productModal') productManager.closeProductModal()">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">×”×•×¡×¤×ª ××•×¦×¨ ×—×“×©</h2>
                <span class="close" onclick="productManager.closeProductModal()">&times;</span>
            </div>

            <form id="productForm" class="product-form">
                <input type="hidden" id="editMode" name="editMode" value="false">
                <div class="form-row">
                    <div class="form-group">
                        <label for="productCode">×§×•×“ ××•×¦×¨</label>
                        <input type="text" id="productCode" name="productCode">
                    </div>

                    <div class="form-group">
                        <label for="productName">×©× ×”××•×¦×¨:</label>
                        <input type="text" id="productName" name="productName">
                    </div>
                    <div class="form-group">
                        <label for="searchName">×©× ×œ×—×™×¤×•×©:</label>
                        <input type="text" id="searchName" name="searchName" placeholder="×©× ×©×•× ×” ×œ×—×™×¤×•×© (××•×¤×¦×™×•× ×œ×™)">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="productCategory">×§×˜×’×•×¨×™×” *</label>
                        <select id="productCategory" name="productCategory" required>
                            <option value="">×‘×—×¨ ×§×˜×’×•×¨×™×”</option>
                            <option value="kitchen">××•×¦×¨×™ ××˜×‘×—</option>
                            <option value="bakery">×§×•× ×“×™×˜×•×¨×™×™×”</option>
                            <option value="fruits">×¤×™×¨×•×ª</option>
                            <option value="sushi">×¡×•×©×™</option>
                            <option value="amar">×§×•× ×“×™×˜×•×¨×™×™×” ×¢××¨</option>
                            <option value="kitchenProducts">××˜×‘×— ××•×¡×˜×¤×”</option>
                            <option value="online">××•× ×œ×™×™×Ÿ</option>
                            <option value="warehouse">××—×¡×Ÿ</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="productType">×¡×•×’ ××•×¦×¨</label>
                        <select id="productType" name="productType">
                            <option value="">×‘×—×¨</option>
                            <option value="size">×’×•×“×œ</option>
                            <option value="quantity">×›××•×ª</option>
                            <option value="none">×œ×œ× ×›××•×ª/×’×•×“×œ</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                <div id="quantity-fields" class="form-group" style="display:none;">
                    <label for="productQuantity">×›××•×ª ×‘×¨×™×¨×ª ××—×“×œ</label>
                    <input type="number" id="productQuantity" name="productQuantity" placeholder="×œ××©×œ: 20" min="1">

                    <label for="unitType" style="margin-top: 10px;">×™×—×™×“×ª ××™×“×”</label>
                    <select id="unitType" name="unitType">
                        <option value="">×‘×—×¨ ×™×—×™×“×”</option>
                        <option value="×™×—×™'">×™×—×™'</option>
                        <option value="×›×•×¡×•×ª">×›×•×¡×•×ª</option>
                    </select>
                </div>

                
                </div>

                <div class="sizes-section" id="sizes-section" style="display: none;">
                    <div class="sizes-header">
                        <h3>ğŸ“ ×’×“×œ×™×/×›××•×™×•×ª ×•××—×™×¨×™×</h3>
                        <button type="button" onclick="productManager.addSizeRow()" class="btn btn-success">â• ×”×•×¡×£ ×©×•×¨×”</button>
                    </div>

                    <div id="sizes-container" class="sizes-container">
                        <!-- ×’×“×œ×™× ×™×•×—×œ×¤×• ×œ×‘×—×™×¨×ª ×’×•×“×œ ××ª×•×š ×¨×©×™××” -->
                        <select id="sizeSelect" name="sizeSelect" style="display:none;">
                            <option value="">×‘×—×¨ ×’×•×“×œ</option>
                            <option value="×’×“×•×œ">×’×“×•×œ</option>
                            <option value="×‘×™× ×•× ×™">×‘×™× ×•× ×™</option>
                        </select>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-success">ğŸ’¾ ×©××•×¨ ××•×¦×¨</button>
                    <button type="button" class="btn btn-secondary" onclick="productManager.closeProductModal()">×‘×™×˜×•×œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal ×œ××™×©×•×¨ ××—×™×§×” -->
    <div id="delete-modal" class="modal" onclick="if(event.target.id === 'delete-modal') productManager.closeDeleteModal()">
        <div class="modal-content delete-modal">
            <div class="modal-header">
                <h2>ğŸ—‘ï¸ ××™×©×•×¨ ××—×™×§×”</h2>
                <span class="close" onclick="productManager.closeDeleteModal()">&times;</span>
            </div>

            <div class="modal-body">
                <p>×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××•×¦×¨ ×–×”?</p>
                <p><strong id="delete-product-name"></strong></p>
            </div>

            <div class="modal-actions">
                <button onclick="productManager.confirmDelete()" class="btn btn-danger">×›×Ÿ, ××—×§</button>
                <button onclick="productManager.closeDeleteModal()" class="btn btn-secondary">×‘×™×˜×•×œ</button>
            </div>
        </div>
    </div>

    <!-- ×”×•×“×¢×•×ª ××¢×¨×›×ª -->
    <div id="notifications-container"></div>

    <script src="admin.js"></script>
<script>
// --- Wake up server logic ---
const SERVER_URL = 'https://nsion-chdash-api.onrender.com';
let serverAwake = false;
let wakeupInterval = null;

function showWakeupOverlay(show) {
    const overlay = document.getElementById('serverWakeupOverlay');
    if (overlay) overlay.style.display = show ? 'flex' : 'none';
}

async function wakeUpServer(showLoader = true) {
    if (showLoader) showWakeupOverlay(true);
    try {
        const res = await fetch(SERVER_URL + '/api/stats', { cache: 'reload' });
        if (res.ok) {
            serverAwake = true;
            showWakeupOverlay(false);
            return true;
        }
    } catch (e) {}
    serverAwake = false;
    if (showLoader) setTimeout(() => wakeUpServer(true), 2000);
    return false;
}

// ×›×œ 4 ×“×§×•×ª ×¤×™× ×’ ×œ×©×¨×ª
function startServerKeepAlive() {
    if (wakeupInterval) clearInterval(wakeupInterval);
    wakeupInterval = setInterval(() => wakeUpServer(false), 240000);
}

// ×”×¤×¢×œ×ª ×”×©×¨×ª ×‘×˜×¢×™× ×” ×¨××©×•× ×™×ª
document.addEventListener('DOMContentLoaded', () => {
    wakeUpServer(true).then(() => {
        startServerKeepAlive();
    });
});
</script>
</body>
</html>